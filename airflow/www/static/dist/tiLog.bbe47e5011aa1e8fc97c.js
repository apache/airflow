/*! For license information please see tiLog.bbe47e5011aa1e8fc97c.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Airflow=t():(e.Airflow=e.Airflow||{},e.Airflow.tiLog=t())}(self,(()=>(()=>{"use strict";var e={1068:(e,t,o)=>{o.d(t,{$O:()=>m,M1:()=>l,n0:()=>d,o0:()=>s,oY:()=>c,z6:()=>i});const n="YYYY-MM-DD, HH:mm:ss",a="YYYY-MM-DD, HH:mm:ss z",r="z (Z)",i="YYYY-MM-DDThh:mm:ssTZD",m="timezone";function l(e){return e instanceof moment?e.isUTC()?"UTC":e.format(r):"UTC"===e?e:moment().tz(e).format(r)}function d(e,t){const o=moment(e),a=$.extend({title:!0},t).title,r=document.createElement("time");return r.setAttribute("datetime",o.format()),a&&r.setAttribute("title",o.isUTC()?"":`UTC: ${o.clone().utc().format()}`),r.innerText=o.format(n),r}const s=e=>moment(e).format(a);function c(e){moment.tz.setDefault(e),$('time[data-datetime-convert!="false"]').each(((e,t)=>{const o=$(t),r=moment(o.attr("datetime"));r._isValid&&o.text(r.format(o.data("with-tz")?a:n)),void 0!==o.attr("title")&&o.attr("title",r.isUTC()?"":`UTC: ${r.clone().utc().format()}`)})),$(".datetime input").each(((e,t)=>{t.value=moment(t.value).format()}))}},5122:(e,t,o)=>{o.d(t,{escapeHtml:()=>m});var n=o(1068);function a(){const e=moment();$("#clock").attr("datetime",e.format(n.z6)).html(`${e.format("HH:mm")} <strong>${(0,n.M1)(e)}</strong>`)}function r(e){localStorage.setItem("selected-timezone",e);const t=new CustomEvent(n.$O,{detail:e});document.dispatchEvent(t),(0,n.oY)(e),a(),$("body").trigger({type:"airflow.timezone-change",timezone:e})}window.isoDateToTimeEl=n.n0,window.moment=Airflow.moment;const i=document.createElement("span");function m(e){return i.textContent=e,i.innerHTML}window.escapeHtml=m,window.convertSecsToHumanReadable=function(e){const t=e,o=t-Math.floor(t);e=Math.floor(e);const n=Math.floor(e/3600);e-=3600*n;const a=Math.floor(e/60);let r="";return n>0&&(r+=`${n}Hours `),a>0&&(r+=`${a}Min `),(e-=60*a)+o>0&&(Math.floor(t)===t?r+=`${e}Sec`:r+=`${(e+=o).toFixed(3)}Sec`),r},window.postAsForm=function(e,t){const o=$("<form></form>");o.attr("method","POST"),o.attr("action",e),$.each(t||{},((e,t)=>{const n=$("<input></input>");n.attr("type","hidden"),n.attr("name",e),n.attr("value",t),o.append(n)}));const n=$("<input></input>");n.attr("type","hidden"),n.attr("name","csrf_token"),n.attr("value",csrfToken),o.append(n),$(document.body).append(o),o.submit()},$(document).ready((()=>{!function(){const e=moment.tz.guess(),t=localStorage.getItem("selected-timezone"),o=localStorage.getItem("chosen-timezone");function a(t){localStorage.setItem("chosen-timezone",t),t!==e||t!==Airflow.serverTimezone?($("#timezone-manual a").data("timezone",t).text((0,n.M1)(t)),$("#timezone-manual").show()):$("#timezone-manual").hide()}o&&a(o),r(t||Airflow.defaultUITimezone),"UTC"!==Airflow.serverTimezone&&($("#timezone-server a").html(`${(0,n.M1)(Airflow.serverTimezone)} <span class="label label-primary">Server</span>`),$("#timezone-server").show()),Airflow.serverTimezone!==e?$("#timezone-local a").attr("data-timezone",e).html(`${(0,n.M1)(e)} <span class="label label-info">Local</span>`):$("#timezone-local").hide(),$("a[data-timezone]").click((e=>{r($(e.currentTarget).data("timezone"))})),$("#timezone-other").typeahead({source:$(moment.tz.names().map((e=>({category:e.split("/",1)[0],name:e.replace("_"," "),tzName:e})))),showHintOnFocus:"all",showCategoryHeader:!0,items:"all",afterSelect(e){this.$element.val(""),a(e.tzName),r(e.tzName),setTimeout((()=>{document.activeElement.blur(),this.shown=!1,this.focused=!1}),1)}})}(),$("#clock").attr("data-original-title",hostName).attr("data-placement","bottom").parent().show(),a(),setInterval(a,1e3),$.ajaxSetup({beforeSend(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",csrfToken)}}),$.fn.datetimepicker.defaults.format="YYYY-MM-DD HH:mm:ssZ",$.fn.datetimepicker.defaults.sideBySide=!0,$(".datetimepicker").datetimepicker(),$("#filter_form a.filter").click((()=>{$(".datetimepicker").datetimepicker()})),$(".js-tooltip").tooltip()}))}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{o.r(n);var e=o(5122);function t(e){const t=document.querySelector(`meta[name="${e}"]`);return t?t.getAttribute("content"):null}var a=o(1068);const r=t("execution_date"),i=t("dag_id"),m=t("task_id"),l=t("map_index"),d=t("logs_with_metadata_url"),s=parseInt(t("delay"),10),c=parseInt(t("auto_tailing_offset"),10),u=parseInt(t("animation_speed"),10),f=parseInt(t("total_attempts"),10);function p(){$("html, body").animate({scrollTop:$(document).height()},u)}function g(t,o=null,n=!1){return console.debug(`Auto-tailing log for dag_id: ${i}, task_id: ${m}, execution_date: ${r}, map_index: ${l}, try_number: ${t}, metadata: ${JSON.stringify(o)}`),Promise.resolve($.ajax({url:d,data:{dag_id:i,task_id:m,map_index:l,execution_date:r,try_number:t,metadata:JSON.stringify(o)}})).then((o=>{if(o){if(o.error)return o.message&&console.error(`Error while retrieving log: ${o.message}`),void(document.getElementById(`loading-${t}`).style.display="none");if(o.message){let r=!1;n&&function(){const e=$(document).height();return console.debug($(window).scrollTop()),console.debug($(window).height()),console.debug($(document).height()),0!==$(window).scrollTop()&&$(window).scrollTop()+$(window).height()>e-c}()&&(r=!0);const i=/http(s)?:\/\/[\w.-]+(\.?:[\w.-]+)*([/?#][\w\-._~:/?#[\]@!$&'()*+,;=.%]+)?/g,m=/\d{4}[./-]\d{2}[./-]\d{2} \d{2}:\d{2}:\d{2},\d{3}/g,l=/\d{4}[./-]\d{2}[./-]\d{2}T\d{2}:\d{2}:\d{2}.\d{3}[+-]\d{4}/g;o.message.forEach((o=>{const n=`try-${t}-${o[0]}`;let r=document.getElementById(n);if(!r){const e=document.createElement("div"),o=document.createElement("pre");e.appendChild(o),o.innerHTML=`<code id="${n}"  ></code>`,document.getElementById(`log-group-${t}`).appendChild(e),r=document.getElementById(n)}const d=(0,e.escapeHtml)(o[1]).replace(i,(e=>`<a href="${e}" target="_blank">${e}</a>`)).replaceAll(m,(e=>`<time datetime="${e}+00:00" data-with-tz="true">${(0,a.o0)(`${e}+00:00`)}</time>`)).replaceAll(l,(e=>`<time datetime="${e}" data-with-tz="true">${(0,a.o0)(`${e}`)}</time>`));r.innerHTML+=`${d}\n`})),r&&p()}o.metadata.end_of_log?document.getElementById(`loading-${t}`).style.display="none":function(e=s){return new Promise((t=>{setTimeout(t,e)}))}().then((()=>g(t,o.metadata,n)))}else document.getElementById(`loading-${t}`).style.display="none"}))}function h(e){e||(e=$("#ti_log_try_number_list .active a").data("try-number"));const t=new URLSearchParams({dag_id:i,task_id:m,execution_date:r,try_number:e,metadata:"null",format:"file"}),o=`${d}?${t}`;$("#ti_log_download_active").attr("href",o)}window.toggleWrapLogs=function(){$("pre code").toggleClass("wrap")},window.scrollBottomLogs=p,$(document).ready((()=>{for(let e=f;e>=1;e-=1){g(e,null,e===f)}h(),$("#ti_log_try_number_list a").click((function(){h($(this).data("try-number"))}))}))})(),n})()));