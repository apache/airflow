{#
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
#}

{% extends 'admin/model/list.html' %}

{% block model_menu_bar %}
  {% if admin_view.verbose_name_plural %}
    <h2>{{ admin_view.verbose_name_plural|title }}</h2>
    <hr/>
  {% endif %}
  {{ super() }}
{% endblock %}

{% block list_header scoped %}
    {{ super() }}
    {% if admin_view.extra_column %}
        <th>{{ admin_view.extra_column_toggle or 'Extra' }}</th>
        <th data-hide="true"></th>
    {% endif %}
{% endblock %}

{% block list_row scoped %}
    {{ super() }}
    {% if admin_view.extra_column %}
        <td data-toggle="true" class="{{ 'not-empty' if get_value(row, admin_view.extra_column) else 'empty' }}">
        </td>
        <td data-hide="true" class="extra-content">
            {{ get_value(row, admin_view.extra_column) }}
        </td>
    {% endif %}
{% endblock %}

{% block tail_js %}
    {{ super() }}
    <!-- enhances the table with "DataTable" -->
    <script src="{{ url_for('static', filename='jquery.dataTables.min.js') }}" type="text/javascript"></script>
    <script>
        $(function () {
            // initialize the table
            var table = $('.table.model-list').DataTable({
                "paging": false,
                "ordering": false,
                "info": false,
                "filter": false
            });

            $('.table.model-list tbody').on(
                    'click', 'td[data-toggle]',
                    function(ev) {
                        var rowElem = $(ev.currentTarget).closest('tr');
                        var row = table.row(rowElem);

                        if (row.child.isShown()) {
                            row.child.hide();
                            rowElem.removeClass('shown');
                        }
                        else {
                            var content = $('.extra-content', rowElem).html();
                            console.log(row);
                            row.child(content, 'detail-row').show();
                            rowElem.addClass('shown');
                        }
                    })

        });
</script>
{% endblock %}
